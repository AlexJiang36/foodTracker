<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçé Food Tracker - Expiry Date Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab-btn {
            padding: 12px 20px;
            border: none;
            background: white;
            color: #667eea;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
        }

        .content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 2rem;
            margin: 10px 0;
        }

        .stat-card p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .stat-card.expired {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .stat-card.warning {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .stat-card.good {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #da190b;
        }

        .btn-secondary {
            background: #9e9e9e;
            color: white;
        }

        .btn-secondary:hover {
            background: #757575;
        }

        .btn-donate {
            background: #ff9800;
            color: white;
        }

        .btn-donate:hover {
            background: #e68900;
        }

        .recipe-card {
            background: #f9f9f9;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .recipe-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .recipe-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .recipe-description {
            color: #666;
            font-size: 0.95rem;
            margin-bottom: 10px;
            font-style: italic;
        }

        .recipe-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .recipe-detail-item {
            background: white;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid #667eea;
            color: #555;
        }

        .recipe-ingredients {
            background: white;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: #555;
        }

        .recipe-ingredients strong {
            color: #333;
        }

        .recipe-instructions {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 4px;
            font-size: 0.9rem;
            color: #333;
            line-height: 1.5;
        }

        .recipe-difficulty-easy {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .recipe-difficulty-medium {
            background: #fff3e0;
            color: #e65100;
        }

        .recipe-difficulty-hard {
            background: #ffcdd2;
            color: #c62828;
        }

        .food-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 6px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .food-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .food-item.expired {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }

        .food-item.warning {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
        }

        .food-item.good {
            background: #f1f8e9;
            border-left: 4px solid #4caf50;
        }

        .food-info {
            flex: 1;
        }

        .food-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: #333;
            margin-bottom: 5px;
        }

        .food-details {
            font-size: 0.9rem;
            color: #666;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .food-status {
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.85rem;
            text-align: center;
        }

        .status-expired {
            background: #f44336;
            color: white;
        }

        .status-warning {
            background: #ff9800;
            color: white;
        }

        .status-good {
            background: #4caf50;
            color: white;
        }

        .food-actions {
            display: flex;
            gap: 5px;
            margin-left: 15px;
        }

        .btn-icon {
            padding: 8px 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-icon.delete {
            background: #f44336;
        }

        .btn-icon:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            max-width: 400px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }

        .modal.show {
            display: block;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .modal-header h2 {
            margin: 0;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: #333;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 4px solid #f44336;
        }

        .success-message {
            background: #f1f8e9;
            color: #33691e;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 4px solid #4caf50;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }

            .tabs {
                justify-content: center;
            }

            .food-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .food-actions {
                margin-left: 0;
                margin-top: 10px;
                width: 100%;
            }

            .btn-icon {
                flex: 1;
            }

            .stat-card h3 {
                font-size: 1.5rem;
            }
        }

        /* Share Modal Styles */
        #shareModal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
        }

        #shareModal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .share-modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 500px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .share-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
        }

        .share-modal-header h2 {
            margin: 0;
            color: #333;
            font-size: 1.5rem;
        }

        .share-close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .share-close-btn:hover {
            color: #333;
        }

        .share-buttons-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .share-button {
            padding: 15px;
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
        }

        .share-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .share-twitter {
            background: #1DA1F2;
        }

        .share-facebook {
            background: #4267B2;
        }

        .share-whatsapp {
            background: #25D366;
        }

        .share-linkedin {
            background: #0A66C2;
        }

        .share-email {
            background: #EA4335;
        }

        .share-copy {
            background: #667eea;
        }

        .food-item-title-share {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 0.95rem;
            color: #333;
            word-break: break-word;
        }

        .btn-share {
            background: #25D366;
            color: white;
            padding: 8px 12px;
        }

        .btn-share:hover {
            background: #1ead5a;
        }

        /* Sort Controls Styles */
        .sort-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .sort-label {
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .sort-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .sort-btn {
            padding: 8px 14px;
            border: 2px solid #ddd;
            background: white;
            color: #333;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .sort-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .sort-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .sort-btn-group {
            display: flex;
            gap: 5px;
        }

        .sort-btn-group .sort-btn {
            padding: 6px 10px;
            font-size: 0.85rem;
        }

        .sort-order-btn {
            padding: 8px 12px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            color: #333;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        .sort-order-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .sort-order-btn.ascending {
            color: #667eea;
        }

        .sort-order-btn.descending {
            color: #f44336;
        }

        @media (max-width: 768px) {
            .sort-controls {
                flex-direction: column;
                align-items: flex-start;
            }

            .sort-buttons {
                width: 100%;
            }

            .sort-btn {
                flex: 1;
                min-width: 80px;
            }
        }

        /* Batch Actions & Checkbox Styles */
        .batch-actions-bar {
            display: none;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f0f7ff;
            border: 2px solid #2196F3;
            border-radius: 8px;
            animation: slideDown 0.3s ease;
        }

        .batch-actions-bar.active {
            display: flex;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .batch-selection-info {
            font-weight: 600;
            color: #1976D2;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .batch-action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .batch-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .batch-btn-delete {
            background: #f44336;
            color: white;
        }

        .batch-btn-delete:hover {
            background: #d32f2f;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(244, 67, 54, 0.3);
        }

        .batch-btn-consume {
            background: #4CAF50;
            color: white;
        }

        .batch-btn-consume:hover {
            background: #388E3C;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
        }

        .batch-btn-cancel {
            background: #757575;
            color: white;
        }

        .batch-btn-cancel:hover {
            background: #616161;
        }

        .batch-checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-right: 10px;
        }

        .food-item-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .food-item.selected {
            background: #f0f7ff !important;
            border: 2px solid #2196F3 !important;
        }

        .select-all-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: #2196F3;
        }

        /* Undo Button */
        .undo-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 100;
        }

        .undo-btn {
            padding: 12px 18px;
            background: #FF9800;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.4);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .undo-btn:hover {
            background: #F57C00;
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(255, 152, 0, 0.5);
        }

        .undo-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
            transform: none;
        }

        .undo-tooltip {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            white-space: nowrap;
            margin-bottom: 10px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .undo-btn:hover .undo-tooltip {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .batch-actions-bar {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .batch-action-buttons {
                width: 100%;
            }

            .batch-btn {
                flex: 1;
                min-width: 100px;
            }

            .undo-container {
                bottom: 20px;
                right: 20px;
            }

            .undo-btn {
                padding: 10px 14px;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üçé Food Tracker</h1>
            <p>Keep track of your food expiry dates and minimize waste</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('dashboard')">üìä Dashboard</button>
            <button class="tab-btn" onclick="switchTab('add-food')">‚ûï Add Food</button>
            <button class="tab-btn" onclick="switchTab('all-foods')">üìã All Foods</button>
            <button class="tab-btn" onclick="switchTab('expired')">üö® Expired</button>
            <button class="tab-btn" onclick="switchTab('expiring-soon')">‚è∞ Expiring Soon</button>
            <button class="tab-btn" onclick="switchTab('donated')">‚ù§Ô∏è Donate</button>
            <button class="tab-btn" onclick="switchTab('search')">üîç Search</button>
        </div>

        <div class="content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <h2>üìä Dashboard Overview</h2>
                <div id="stats-container" class="stats-grid">
                    <!-- Stats will be loaded here -->
                </div>
                <button class="btn btn-secondary" onclick="addSampleData()">Add Sample Data</button>
            </div>

            <!-- Add Food Tab -->
            <div id="add-food" class="tab-content">
                <h2>‚ûï Add New Food</h2>
                <div id="add-error-message"></div>
                <form onsubmit="handleAddFood(event)">
                    <div class="form-group">
                        <label for="food-name">Food Name *</label>
                        <input type="text" id="food-name" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="food-quantity">Quantity *</label>
                            <input type="number" id="food-quantity" required min="1">
                        </div>
                        <div class="form-group">
                            <label for="food-unit">Unit *</label>
                            <select id="food-unit" required>
                                <option value="">Select unit</option>
                                <option value="pcs">pcs (pieces)</option>
                                <option value="kg">kg</option>
                                <option value="L">L (liters)</option>
                                <option value="g">g (grams)</option>
                                <option value="ml">ml</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="food-expiry">Expiry Date *</label>
                            <input type="date" id="food-expiry" required>
                        </div>
                        <div class="form-group">
                            <label for="food-category">Category *</label>
                            <select id="food-category" required>
                                <option value="">Select category</option>
                                <option value="produce">Produce</option>
                                <option value="dairy">Dairy</option>
                                <option value="meat">Meat</option>
                                <option value="pantry">Pantry</option>
                                <option value="frozen">Frozen</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <button type="submit" class="btn btn-primary">Add Food</button>
                        <button type="reset" class="btn btn-secondary" style="margin-left: 10px;">Clear</button>
                    </div>
                </form>
            </div>

            <!-- All Foods Tab -->
            <div id="all-foods" class="tab-content">
                <h2>üìã All Foods</h2>
                <div class="sort-controls">
                    <span class="sort-label">üîÄ Sort by:</span>
                    <div class="sort-buttons">
                        <button class="sort-btn active" onclick="setSortBy('name')">üìù Name</button>
                        <button class="sort-btn" onclick="setSortBy('expiry')">üìÖ Expiry Date</button>
                        <button class="sort-btn" onclick="setSortBy('status')">üè∑Ô∏è Status</button>
                    </div>
                    <button class="sort-order-btn ascending" onclick="toggleSortOrder()" title="Click to reverse order">‚Üë</button>
                </div>
                <!-- Batch Actions Bar -->
                <div id="all-foods-batch-bar" class="batch-actions-bar">
                    <div class="batch-selection-info">
                        <span id="all-foods-selection-count">0 items selected</span>
                    </div>
                    <div class="batch-action-buttons">
                        <button class="batch-btn batch-btn-consume" onclick="batchConsume('all-foods')">‚úÖ Mark Consumed</button>
                        <button class="batch-btn batch-btn-delete" onclick="batchDelete('all-foods')">üóëÔ∏è Delete Selected</button>
                        <button class="batch-btn batch-btn-cancel" onclick="clearSelection('all-foods')">‚ùå Cancel</button>
                    </div>
                </div>
                <div id="all-foods-container">
                    <!-- Foods will be loaded here -->
                </div>
            </div>

            <!-- Expired Tab -->
            <div id="expired" class="tab-content">
                <h2>üö® Expired Foods</h2>
                <div class="sort-controls">
                    <span class="sort-label">üîÄ Sort by:</span>
                    <div class="sort-buttons">
                        <button class="sort-btn active" onclick="setSortBy('name', 'expired')">üìù Name</button>
                        <button class="sort-btn" onclick="setSortBy('expiry', 'expired')">üìÖ Expiry Date</button>
                    </div>
                    <button class="sort-order-btn ascending" onclick="toggleSortOrder('expired')" title="Click to reverse order">‚Üë</button>
                </div>
                <!-- Batch Actions Bar -->
                <div id="expired-batch-bar" class="batch-actions-bar">
                    <div class="batch-selection-info">
                        <span id="expired-selection-count">0 items selected</span>
                    </div>
                    <div class="batch-action-buttons">
                        <button class="batch-btn batch-btn-consume" onclick="batchConsume('expired')">‚úÖ Mark Consumed</button>
                        <button class="batch-btn batch-btn-delete" onclick="batchDelete('expired')">üóëÔ∏è Delete Selected</button>
                        <button class="batch-btn batch-btn-cancel" onclick="clearSelection('expired')">‚ùå Cancel</button>
                    </div>
                </div>
                <div id="expired-container">
                    <!-- Expired foods will be loaded here -->
                </div>
            </div>

            <!-- Expiring Soon Tab -->
            <div id="expiring-soon" class="tab-content">
                <h2>‚è∞ Foods Expiring Soon (‚â§3 days)</h2>
                <div class="sort-controls">
                    <span class="sort-label">üîÄ Sort by:</span>
                    <div class="sort-buttons">
                        <button class="sort-btn active" onclick="setSortBy('name', 'expiring-soon')">üìù Name</button>
                        <button class="sort-btn" onclick="setSortBy('expiry', 'expiring-soon')">üìÖ Expiry Date</button>
                    </div>
                    <button class="sort-order-btn ascending" onclick="toggleSortOrder('expiring-soon')" title="Click to reverse order">‚Üë</button>
                </div>
                <!-- Batch Actions Bar -->
                <div id="expiring-soon-batch-bar" class="batch-actions-bar">
                    <div class="batch-selection-info">
                        <span id="expiring-soon-selection-count">0 items selected</span>
                    </div>
                    <div class="batch-action-buttons">
                        <button class="batch-btn batch-btn-consume" onclick="batchConsume('expiring-soon')">‚úÖ Mark Consumed</button>
                        <button class="batch-btn batch-btn-delete" onclick="batchDelete('expiring-soon')">üóëÔ∏è Delete Selected</button>
                        <button class="batch-btn batch-btn-cancel" onclick="clearSelection('expiring-soon')">‚ùå Cancel</button>
                    </div>
                </div>
                <div id="expiring-soon-container">
                    <!-- Expiring soon foods will be loaded here -->
                </div>
                <h3 style="margin: 30px 0 15px 0; color: #333;">üç≥ Recipe Suggestions</h3>
                <p style="color: #666; margin-bottom: 15px;">Use these recipes to cook with your expiring foods!</p>
                <div id="recipe-suggestions-container">
                    <!-- Recipe suggestions will be loaded here -->
                </div>
            </div>

            <!-- Donate Tab -->
            <div id="donated" class="tab-content">
                <h2>‚ù§Ô∏è Donate Food</h2>
                <p style="margin-bottom: 20px; color: #666;">Share your food with others! Select foods from "All Foods" tab and click the donate button.</p>
                <div class="sort-controls">
                    <span class="sort-label">üîÄ Sort by:</span>
                    <div class="sort-buttons">
                        <button class="sort-btn active" onclick="setSortBy('name', 'donated')">üìù Name</button>
                        <button class="sort-btn" onclick="setSortBy('expiry', 'donated')">üìÖ Expiry Date</button>
                    </div>
                    <button class="sort-order-btn ascending" onclick="toggleSortOrder('donated')" title="Click to reverse order">‚Üë</button>
                </div>
                <!-- Batch Actions Bar -->
                <div id="donated-batch-bar" class="batch-actions-bar">
                    <div class="batch-selection-info">
                        <span id="donated-selection-count">0 items selected</span>
                    </div>
                    <div class="batch-action-buttons">
                        <button class="batch-btn batch-btn-delete" onclick="batchDelete('donated')">üóëÔ∏è Delete Selected</button>
                        <button class="batch-btn batch-btn-cancel" onclick="clearSelection('donated')">‚ùå Cancel</button>
                    </div>
                </div>
                <h3 style="margin: 20px 0 15px 0;">Donated Foods</h3>
                <div id="donated-foods-container">
                    <!-- Donated foods will be loaded here -->
                </div>
            </div>

            <!-- Search Tab -->
            <div id="search" class="tab-content">
                <h2>üîç Search Foods</h2>
                <div class="search-box">
                    <input type="text" id="search-input" placeholder="Enter food name..." 
                           onkeyup="handleSearch(this.value)">
                </div>
                <div id="search-results-container">
                    <!-- Search results will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Undo Container -->
    <div class="undo-container" id="undo-container" style="display: none;">
        <button class="undo-btn" onclick="undoLastAction()" id="undo-btn" title="Undo last action">
            ‚Ü∂ Undo
            <span class="undo-tooltip" id="undo-tooltip">Click to undo</span>
        </button>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Food</h2>
                <button class="close-btn" onclick="closeEditModal()">&times;</button>
            </div>
            <form onsubmit="handleEditFood(event)">
                <div class="form-group">
                    <label for="edit-food-name">Food Name *</label>
                    <input type="text" id="edit-food-name" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-food-quantity">Quantity *</label>
                        <input type="number" id="edit-food-quantity" required min="1">
                    </div>
                    <div class="form-group">
                        <label for="edit-food-unit">Unit *</label>
                        <select id="edit-food-unit" required>
                            <option value="pcs">pcs (pieces)</option>
                            <option value="kg">kg</option>
                            <option value="L">L (liters)</option>
                            <option value="g">g (grams)</option>
                            <option value="ml">ml</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-food-expiry">Expiry Date *</label>
                        <input type="date" id="edit-food-expiry" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-food-category">Category *</label>
                        <select id="edit-food-category" required>
                            <option value="produce">Produce</option>
                            <option value="dairy">Dairy</option>
                            <option value="meat">Meat</option>
                            <option value="pantry">Pantry</option>
                            <option value="frozen">Frozen</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" class="modal">
        <div class="share-modal-content">
            <div class="share-modal-header">
                <h2>üì§ Share Food to Donate</h2>
                <button class="share-close-btn" onclick="closeShareModal()">&times;</button>
            </div>
            <div class="food-item-title-share" id="share-food-name">
                <!-- Food name will be inserted here -->
            </div>
            <div class="share-buttons-grid">
                <button class="share-button share-twitter" onclick="shareOnTwitter()">
                    ùïè Twitter
                </button>
                <button class="share-button share-facebook" onclick="shareOnFacebook()">
                    f Facebook
                </button>
                <button class="share-button share-whatsapp" onclick="shareOnWhatsApp()">
                    üí¨ WhatsApp
                </button>
                <button class="share-button share-linkedin" onclick="shareOnLinkedIn()">
                    in LinkedIn
                </button>
                <button class="share-button share-email" onclick="shareViaEmail()">
                    ‚úâÔ∏è Email
                </button>
                <button class="share-button share-copy" onclick="copyShareLink()">
                    üìã Copy Link
                </button>
            </div>
            <div style="background: #f0f7ff; padding: 12px; border-radius: 6px; border-left: 4px solid #2196F3; margin-top: 15px;">
                <p style="margin: 0; color: #1565c0; font-size: 0.9rem;">
                    ‚ÑπÔ∏è <strong>Tip:</strong> Share the details of your food donation on social media to help others know about it!
                </p>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8080/api/foods';
        let editingFoodId = null;

        // Sort state
        let sortSettings = {
            'all-foods': { by: 'name', order: 'asc' },
            'expired': { by: 'name', order: 'asc' },
            'expiring-soon': { by: 'name', order: 'asc' },
            'donated': { by: 'name', order: 'asc' }
        };

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active state from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Load data based on tab
            if (tabName === 'dashboard') loadStats();
            else if (tabName === 'all-foods') loadAllFoods();
            else if (tabName === 'expired') loadExpiredFoods();
            else if (tabName === 'expiring-soon') loadExpiringSoon();
            else if (tabName === 'donated') loadDonatedFoods();
        }

        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}/statistics`);
                const stats = await response.json();
                
                const statsHtml = `
                    <div class="stat-card">
                        <p>Total Items</p>
                        <h3>${stats.totalItems}</h3>
                    </div>
                    <div class="stat-card good">
                        <p>Good to Use</p>
                        <h3>${stats.goodCount}</h3>
                    </div>
                    <div class="stat-card warning">
                        <p>Expiring Soon</p>
                        <h3>${stats.expiringSoonCount}</h3>
                    </div>
                    <div class="stat-card expired">
                        <p>Expired</p>
                        <h3>${stats.expiredCount}</h3>
                    </div>
                    <div class="stat-card">
                        <p>This Week</p>
                        <h3>${stats.expiringThisWeekCount}</h3>
                    </div>
                `;
                
                document.getElementById('stats-container').innerHTML = statsHtml;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Add food
        async function handleAddFood(e) {
            e.preventDefault();
            
            const foodData = {
                name: document.getElementById('food-name').value,
                quantity: parseInt(document.getElementById('food-quantity').value),
                unit: document.getElementById('food-unit').value,
                expiryDate: document.getElementById('food-expiry').value,
                category: document.getElementById('food-category').value
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(foodData)
                });

                if (response.ok) {
                    showSuccessMessage('Food added successfully!');
                    document.querySelector('form').reset();
                    setTimeout(() => loadAllFoods(), 500);
                } else {
                    showErrorMessage('Failed to add food');
                }
            } catch (error) {
                showErrorMessage('Error: ' + error.message);
            }
        }

        // Load all foods
        async function loadAllFoods() {
            try {
                const response = await fetch(API_URL);
                const foods = await response.json();
                displayFoods(foods, 'all-foods-container');
            } catch (error) {
                console.error('Error loading foods:', error);
            }
        }

        // Load expired foods
        async function loadExpiredFoods() {
            try {
                const response = await fetch(`${API_URL}/status/expired`);
                const foods = await response.json();
                displayFoods(foods, 'expired-container');
            } catch (error) {
                console.error('Error loading expired foods:', error);
            }
        }

        // Load expiring soon
        async function loadExpiringSoon() {
            try {
                const response = await fetch(`${API_URL}/status/expiring-soon`);
                const foods = await response.json();
                displayFoods(foods, 'expiring-soon-container');
                
                // Load recipes based on expiring foods
                if (foods && foods.length > 0) {
                    const categories = [...new Set(foods.map(f => f.category))];
                    for (const category of categories) {
                        await loadRecipesForCategory(category);
                    }
                }
            } catch (error) {
                console.error('Error loading expiring soon foods:', error);
            }
        }

        // Search foods
        async function handleSearch(query) {
            if (query.length < 1) {
                document.getElementById('search-results-container').innerHTML = '';
                return;
            }

            try {
                const response = await fetch(`${API_URL}/search?query=${encodeURIComponent(query)}`);
                const foods = await response.json();
                displayFoods(foods, 'search-results-container');
            } catch (error) {
                console.error('Error searching foods:', error);
            }
        }

        // Sort Functions
        function setSortBy(sortBy, tabId = 'all-foods') {
            if (!sortSettings[tabId]) {
                sortSettings[tabId] = { by: 'name', order: 'asc' };
            }
            sortSettings[tabId].by = sortBy;
            updateSortButtons(tabId);
            reloadCurrentTab(tabId);
        }

        function toggleSortOrder(tabId = 'all-foods') {
            if (!sortSettings[tabId]) {
                sortSettings[tabId] = { by: 'name', order: 'asc' };
            }
            sortSettings[tabId].order = sortSettings[tabId].order === 'asc' ? 'desc' : 'asc';
            updateSortOrderButton(tabId);
            reloadCurrentTab(tabId);
        }

        function updateSortButtons(tabId) {
            const buttons = document.querySelectorAll(`#${tabId} .sort-btn`);
            buttons.forEach(btn => btn.classList.remove('active'));
            
            const sortBy = sortSettings[tabId]?.by || 'name';
            buttons.forEach(btn => {
                if (btn.textContent.includes(
                    sortBy === 'name' ? 'Name' :
                    sortBy === 'expiry' ? 'Expiry' :
                    sortBy === 'status' ? 'Status' : ''
                )) {
                    btn.classList.add('active');
                }
            });
        }

        function updateSortOrderButton(tabId) {
            const btn = document.querySelector(`#${tabId} .sort-order-btn`);
            if (!btn) return;
            
            const order = sortSettings[tabId]?.order || 'asc';
            btn.textContent = order === 'asc' ? '‚Üë' : '‚Üì';
            btn.classList.remove('ascending', 'descending');
            btn.classList.add(order === 'asc' ? 'ascending' : 'descending');
        }

        function sortFoods(foods, tabId = 'all-foods') {
            if (!foods || foods.length === 0) return foods;
            
            const settings = sortSettings[tabId] || { by: 'name', order: 'asc' };
            let sorted = [...foods];

            // Sort by criteria
            if (settings.by === 'name') {
                sorted.sort((a, b) => a.name.localeCompare(b.name));
            } else if (settings.by === 'expiry') {
                sorted.sort((a, b) => new Date(a.expiryDate) - new Date(b.expiryDate));
            } else if (settings.by === 'status') {
                const statusOrder = { 'EXPIRED': 0, 'EXPIRING_SOON': 1, 'GOOD': 2 };
                sorted.sort((a, b) => statusOrder[a.status] - statusOrder[b.status]);
            }

            // Apply sort order
            if (settings.order === 'desc') {
                sorted.reverse();
            }

            return sorted;
        }

        function reloadCurrentTab(tabId) {
            if (tabId === 'all-foods') loadAllFoods();
            else if (tabId === 'expired') loadExpiredFoods();
            else if (tabId === 'expiring-soon') loadExpiringSoon();
            else if (tabId === 'donated') loadDonatedFoods();
        }

        // Batch Actions & Undo System
        let actionHistory = [];
        const MAX_HISTORY = 20;

        function saveAction(action, data) {
            // Save action to history
            actionHistory.push({
                type: action,
                timestamp: new Date(),
                data: data
            });

            // Keep only last MAX_HISTORY actions
            if (actionHistory.length > MAX_HISTORY) {
                actionHistory.shift();
            }

            // Show undo button
            updateUndoButton();
        }

        function updateBatchSelection(tabId) {
            const container = document.getElementById(
                tabId === 'all-foods' ? 'all-foods-container' :
                tabId === 'expired' ? 'expired-container' :
                tabId === 'expiring-soon' ? 'expiring-soon-container' :
                'donated-foods-container'
            );

            const checkboxes = container.querySelectorAll('.food-item-checkbox');
            const selectedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
            
            const batchBar = document.getElementById(`${tabId}-batch-bar`);
            const countDisplay = document.getElementById(`${tabId}-selection-count`);
            
            if (selectedCount > 0) {
                batchBar.classList.add('active');
                countDisplay.textContent = `${selectedCount} item${selectedCount !== 1 ? 's' : ''} selected`;
                
                // Highlight selected items
                container.querySelectorAll('.food-item').forEach(item => {
                    const checkbox = item.querySelector('.food-item-checkbox');
                    if (checkbox.checked) {
                        item.classList.add('selected');
                    } else {
                        item.classList.remove('selected');
                    }
                });
            } else {
                batchBar.classList.remove('active');
                countDisplay.textContent = '0 items selected';
                container.querySelectorAll('.food-item').forEach(item => {
                    item.classList.remove('selected');
                });
            }
        }

        function getSelectedIds(tabId) {
            const container = document.getElementById(
                tabId === 'all-foods' ? 'all-foods-container' :
                tabId === 'expired' ? 'expired-container' :
                tabId === 'expiring-soon' ? 'expiring-soon-container' :
                'donated-foods-container'
            );

            const checkboxes = container.querySelectorAll('.food-item-checkbox:checked');
            return Array.from(checkboxes).map(cb => parseInt(cb.dataset.foodId));
        }

        async function batchDelete(tabId) {
            const selectedIds = getSelectedIds(tabId);
            
            if (selectedIds.length === 0) {
                showErrorMessage('Please select items to delete');
                return;
            }

            if (!confirm(`Delete ${selectedIds.length} item${selectedIds.length !== 1 ? 's' : ''}? This action can be undone.`)) {
                return;
            }

            try {
                // Get food data before deletion for undo
                const container = document.getElementById(
                    tabId === 'all-foods' ? 'all-foods-container' :
                    tabId === 'expired' ? 'expired-container' :
                    tabId === 'expiring-soon' ? 'expiring-soon-container' :
                    'donated-foods-container'
                );
                const foodItems = [];
                selectedIds.forEach(id => {
                    const item = container.querySelector(`[data-food-id="${id}"]`);
                    if (item) {
                        foodItems.push({
                            id: id,
                            element: item.cloneNode(true)
                        });
                    }
                });

                // Delete each food item
                for (const id of selectedIds) {
                    await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
                }

                // Save action for undo
                saveAction('batch-delete', {
                    ids: selectedIds,
                    items: foodItems,
                    tabId: tabId
                });

                showSuccessMessage(`Deleted ${selectedIds.length} item${selectedIds.length !== 1 ? 's' : ''}! üóëÔ∏è`);
                reloadCurrentTab(tabId);
            } catch (error) {
                showErrorMessage('Failed to delete items: ' + error.message);
            }
        }

        async function batchConsume(tabId) {
            const selectedIds = getSelectedIds(tabId);
            
            if (selectedIds.length === 0) {
                showErrorMessage('Please select items to mark as consumed');
                return;
            }

            if (!confirm(`Mark ${selectedIds.length} item${selectedIds.length !== 1 ? 's' : ''} as consumed? This action can be undone.`)) {
                return;
            }

            try {
                // Get food data before consumption for undo
                const consumedFoods = [];

                // Delete each food item (marking consumed is equivalent to removal)
                for (const id of selectedIds) {
                    const response = await fetch(`${API_URL}/${id}`);
                    const food = await response.json();
                    consumedFoods.push(food);
                    await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
                }

                // Save action for undo
                saveAction('batch-consume', {
                    ids: selectedIds,
                    foods: consumedFoods,
                    tabId: tabId
                });

                showSuccessMessage(`Marked ${selectedIds.length} item${selectedIds.length !== 1 ? 's' : ''} as consumed! ‚úÖ`);
                reloadCurrentTab(tabId);
            } catch (error) {
                showErrorMessage('Failed to mark items as consumed: ' + error.message);
            }
        }

        function clearSelection(tabId) {
            const container = document.getElementById(
                tabId === 'all-foods' ? 'all-foods-container' :
                tabId === 'expired' ? 'expired-container' :
                tabId === 'expiring-soon' ? 'expiring-soon-container' :
                'donated-foods-container'
            );

            container.querySelectorAll('.food-item-checkbox').forEach(cb => cb.checked = false);
            updateBatchSelection(tabId);
        }

        function updateUndoButton() {
            const undoContainer = document.getElementById('undo-container');
            const undoBtn = document.getElementById('undo-btn');
            const undoTooltip = document.getElementById('undo-tooltip');

            if (actionHistory.length > 0) {
                undoContainer.style.display = 'block';
                const lastAction = actionHistory[actionHistory.length - 1];
                const actionText = lastAction.type === 'batch-delete' ? 'Undo deletion' :
                                 lastAction.type === 'batch-consume' ? 'Undo consuming' : 'Undo action';
                undoTooltip.textContent = actionText;
            } else {
                undoContainer.style.display = 'none';
            }
        }

        async function undoLastAction() {
            if (actionHistory.length === 0) {
                showErrorMessage('No action to undo');
                return;
            }

            const lastAction = actionHistory.pop();

            try {
                if (lastAction.type === 'batch-delete' || lastAction.type === 'batch-consume') {
                    // Restore deleted/consumed items
                    for (const food of lastAction.data.foods) {
                        await fetch(API_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(food)
                        });
                    }

                    showSuccessMessage('Action undone! ‚Ü∂');
                    reloadCurrentTab(lastAction.data.tabId);
                }
            } catch (error) {
                showErrorMessage('Failed to undo: ' + error.message);
                // Re-add to history if failed
                actionHistory.push(lastAction);
            }

            updateUndoButton();
        }

        // Display foods
        function displayFoods(foods, containerId) {
            const container = document.getElementById(containerId);
            
            if (!foods || foods.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì≠</div><p>No foods found</p></div>';
                return;
            }

            // Determine tab ID from container ID
            let tabId = 'all-foods';
            if (containerId === 'all-foods-container') tabId = 'all-foods';
            else if (containerId === 'expired-container') tabId = 'expired';
            else if (containerId === 'expiring-soon-container') tabId = 'expiring-soon';
            else if (containerId === 'donated-foods-container') tabId = 'donated';

            // Apply sorting
            const sortedFoods = sortFoods(foods, tabId);
            // Update sort button UI
            updateSortButtons(tabId);
            updateSortOrderButton(tabId);

            const foodsHtml = sortedFoods.map(food => {
                const statusClass = food.status === 'EXPIRED' ? 'expired' : 
                                   food.status === 'EXPIRING_SOON' ? 'warning' : 'good';
                const statusLabel = food.status === 'EXPIRED' ? 'üö® EXPIRED' : 
                                   food.status === 'EXPIRING_SOON' ? '‚è∞ EXPIRING SOON' : '‚úÖ GOOD';
                
                const expiryDate = new Date(food.expiryDate).toLocaleDateString();
                
                // Check if this is the donated foods section
                const isDonatedSection = containerId === 'donated-foods-container';
                
                return `
                    <div class="food-item ${statusClass}" data-food-id="${food.id}" data-tab="${tabId}">
                        <div class="batch-checkbox-wrapper">
                            <input type="checkbox" class="food-item-checkbox" data-food-id="${food.id}" onchange="updateBatchSelection('${tabId}')">
                        </div>
                        <div class="food-info">
                            <div class="food-name">${food.name}</div>
                            <div class="food-details">
                                <span>üì¶ ${food.quantity} ${food.unit}</span>
                                <span>üè∑Ô∏è ${food.category}</span>
                                <span>üìÖ ${expiryDate}</span>
                                <span>‚è±Ô∏è ${food.daysUntilExpiry} days</span>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="food-status status-${statusClass}">${statusLabel}</span>
                            <div class="food-actions">
                                <button class="btn-icon" onclick="openEditModal(${food.id}, '${food.name}', ${food.quantity}, '${food.unit}', '${food.expiryDate}', '${food.category}')">‚úèÔ∏è</button>
                                ${isDonatedSection 
                                    ? `<button class="btn-icon btn-share" onclick="openShareModal('${food.name}', '${food.quantity}', '${food.unit}', '${food.category}')">üì§</button>` 
                                    : `<button class="btn-icon" style="background: #ff9800;" onclick="donateFood(${food.id})" title="Donate">‚ù§Ô∏è</button>`
                                }
                                <button class="btn-icon delete" onclick="deleteFood(${food.id})">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = foodsHtml;
        }

        // Edit food
        function openEditModal(id, name, quantity, unit, expiryDate, category) {
            editingFoodId = id;
            document.getElementById('edit-food-name').value = name;
            document.getElementById('edit-food-quantity').value = quantity;
            document.getElementById('edit-food-unit').value = unit;
            document.getElementById('edit-food-expiry').value = expiryDate;
            document.getElementById('edit-food-category').value = category;
            document.getElementById('editModal').classList.add('show');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
            editingFoodId = null;
        }

        async function handleEditFood(e) {
            e.preventDefault();
            
            const foodData = {
                name: document.getElementById('edit-food-name').value,
                quantity: parseInt(document.getElementById('edit-food-quantity').value),
                unit: document.getElementById('edit-food-unit').value,
                expiryDate: document.getElementById('edit-food-expiry').value,
                category: document.getElementById('edit-food-category').value
            };

            try {
                const response = await fetch(`${API_URL}/${editingFoodId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(foodData)
                });

                if (response.ok) {
                    closeEditModal();
                    showSuccessMessage('Food updated successfully!');
                    loadAllFoods();
                } else {
                    showErrorMessage('Failed to update food');
                }
            } catch (error) {
                showErrorMessage('Error: ' + error.message);
            }
        }

        // Delete food
        async function deleteFood(id) {
            if (confirm('Are you sure you want to delete this food?')) {
                try {
                    const response = await fetch(`${API_URL}/${id}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        showSuccessMessage('Food deleted successfully!');
                        loadAllFoods();
                    } else {
                        showErrorMessage('Failed to delete food');
                    }
                } catch (error) {
                    showErrorMessage('Error: ' + error.message);
                }
            }
        }

        // Add sample data
        async function addSampleData() {
            try {
                const response = await fetch(`${API_URL}/sample-data`, {
                    method: 'POST'
                });

                if (response.ok) {
                    showSuccessMessage('Sample data added successfully!');
                    loadStats();
                } else {
                    showErrorMessage('Failed to add sample data');
                }
            } catch (error) {
                showErrorMessage('Error: ' + error.message);
            }
        }

        // Load recipes for category
        async function loadRecipesForCategory(category) {
            try {
                const response = await fetch(`${API_URL}/recipes/category/${category}`);
                const recipes = await response.json();
                displayRecipes(recipes);
            } catch (error) {
                console.error('Error loading recipes:', error);
            }
        }

        // Display recipes
        function displayRecipes(recipes) {
            const container = document.getElementById('recipe-suggestions-container');
            
            if (!recipes || recipes.length === 0) {
                if (!container.innerHTML) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üç≥</div><p>No recipe suggestions available</p></div>';
                }
                return;
            }

            // Remove duplicates based on recipe name
            const uniqueRecipes = [];
            const recipeNames = new Set();
            recipes.forEach(recipe => {
                if (!recipeNames.has(recipe.name)) {
                    uniqueRecipes.push(recipe);
                    recipeNames.add(recipe.name);
                }
            });

            const recipesHtml = uniqueRecipes.map(recipe => {
                const difficultyClass = recipe.difficulty.toLowerCase().includes('easy') ? 'recipe-difficulty-easy' :
                                       recipe.difficulty.toLowerCase().includes('medium') ? 'recipe-difficulty-medium' :
                                       'recipe-difficulty-hard';
                
                return `
                    <div class="recipe-card">
                        <div class="recipe-name">
                            üç≥ ${recipe.name}
                        </div>
                        <div class="recipe-description">${recipe.description}</div>
                        <div class="recipe-details">
                            <div class="recipe-detail-item">‚è±Ô∏è ${recipe.cookingTime}</div>
                            <div class="recipe-detail-item ${difficultyClass}" style="border-left: 3px solid;">
                                üìä ${recipe.difficulty}
                            </div>
                        </div>
                        <div class="recipe-ingredients">
                            <strong>üìù Ingredients:</strong> ${recipe.ingredients.join(', ')}
                        </div>
                        <div class="recipe-instructions">
                            <strong>üë®‚Äçüç≥ Instructions:</strong><br/>${recipe.instructions}
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = recipesHtml;
        }

        // Donate food
        async function donateFood(id) {
            if (confirm('Are you sure you want to donate this food?')) {
                try {
                    const response = await fetch(`${API_URL}/${id}/donate`, {
                        method: 'POST'
                    });

                    if (response.ok) {
                        showSuccessMessage('Food donated successfully! ‚ù§Ô∏è');
                        loadAllFoods();
                        loadDonatedFoods();
                    } else {
                        showErrorMessage('Failed to donate food');
                    }
                } catch (error) {
                    showErrorMessage('Error: ' + error.message);
                }
            }
        }

        // Load donated foods
        async function loadDonatedFoods() {
            try {
                const response = await fetch(`${API_URL}/donated/list`);
                const foods = await response.json();
                displayFoods(foods, 'donated-foods-container');
            } catch (error) {
                console.error('Error loading donated foods:', error);
            }
        }

        // Share Functions
        let currentShareData = {};

        function openShareModal(foodName, quantity, unit, category) {
            currentShareData = {
                foodName: foodName,
                quantity: quantity,
                unit: unit,
                category: category,
                shareUrl: window.location.href
            };
            
            document.getElementById('share-food-name').textContent = 
                `üç≤ ${foodName} (${quantity} ${unit}) - ${category}`;
            document.getElementById('shareModal').classList.add('show');
        }

        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('show');
        }

        function generateShareMessage() {
            const { foodName, quantity, unit, category } = currentShareData;
            return `üç≤ I'm donating ${quantity} ${unit} of ${foodName} (${category})! Available for pickup. Help reduce food waste! üíö`;
        }

        function shareOnTwitter() {
            const message = generateShareMessage();
            const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank', 'width=600,height=400');
        }

        function shareOnFacebook() {
            const message = generateShareMessage();
            const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${encodeURIComponent(message)}`;
            window.open(url, '_blank', 'width=600,height=400');
        }

        function shareOnWhatsApp() {
            const message = generateShareMessage();
            const url = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }

        function shareOnLinkedIn() {
            const message = generateShareMessage();
            const url = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(window.location.href)}&summary=${encodeURIComponent(message)}`;
            window.open(url, '_blank', 'width=600,height=400');
        }

        function shareViaEmail() {
            const { foodName, quantity, unit, category } = currentShareData;
            const subject = `Available for Donation: ${quantity} ${unit} of ${foodName}`;
            const body = `Hi,\n\nI have ${quantity} ${unit} of ${foodName} (${category}) available for donation.\n\nIf you're interested, please let me know!\n\nBest regards`;
            const url = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.location.href = url;
        }

        function copyShareLink() {
            const message = generateShareMessage();
            const fullMessage = `${message}\n\nLink: ${window.location.href}`;
            
            navigator.clipboard.writeText(fullMessage).then(() => {
                showSuccessMessage('‚úÖ Share message copied to clipboard!');
                closeShareModal();
            }).catch(err => {
                showErrorMessage('Failed to copy to clipboard');
            });
        }

        // Message helpers
        function showSuccessMessage(message) {
            const container = document.getElementById('add-error-message');
            if (container) {
                container.innerHTML = `<div class="success-message">${message}</div>`;
                setTimeout(() => {
                    container.innerHTML = '';
                }, 3000);
            }
        }

        function showErrorMessage(message) {
            const container = document.getElementById('add-error-message');
            if (container) {
                container.innerHTML = `<div class="error-message">${message}</div>`;
                setTimeout(() => {
                    container.innerHTML = '';
                }, 3000);
            }
        }

        // Set today's date as minimum for date input
        function setMinDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('food-expiry').setAttribute('min', today);
            document.getElementById('edit-food-expiry').setAttribute('min', today);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const editModal = document.getElementById('editModal');
            if (event.target === editModal) {
                closeEditModal();
            }
            const shareModal = document.getElementById('shareModal');
            if (event.target === shareModal) {
                closeShareModal();
            }
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            setMinDate();
            loadStats();
        });
    </script>
</body>
</html>
